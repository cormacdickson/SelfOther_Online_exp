<!DOCTYPE html>
<html>
  <head>
  	<meta charset="UTF-8">
    <title>Social Experiment</title>
    <script src="jspsych/jspsych.js"></script>
    <script src="jspsych/plugin-fullscreen.js"></script>
    <script src="jspsych/plugin-instructions.js"></script>
    <script src="jspsych/plugin-survey-text.js"></script>
    <script src="jspsych/plugin-survey-multi-choice.js"></script>
    <script src="jspsych/plugin-rdk.js"></script>
    <link href="jspsych/jspsych.css" rel="stylesheet" type="text/css" />

    <link rel="stylesheet" href="https://unpkg.com/@jspsych/plugin-survey@0.1.1/css/survey.css">
  	</head>

  	<body>

  	</body>
  	<script>

    const jsPsych = initJsPsych();

    
var enter_fullscreen = {
  type: jsPsychFullscreen,
  fullscreen_mode: true
}



var get_initials = {
  type: jsPsychSurveyText,
  questions: [ {prompt: 'Please enter your initials in the box below:', required: true}],
  on_finish: function(data) {
        initials = data.response.Q0.toUpperCase();
        jsPsych.data.addProperties({ id: initials });
    }
}




var confirm_initials = {
  type: jsPsychSurveyMultiChoice,
  questions: [{
      prompt: function(data) {
        return ['<p> please confirm your initials are: <br>  </p>'] 
      },
      name: 'confirmInitials', 
      options: ['Confirm', 'Re-enter initals'], 
      required: true
  }],
};


var confirm_node = {
  timeline: [get_initials],
  conditional_function: function(){
      // get the data from the previous trial,
      // if they confirmed their initials proceed, if not run get intials again
      var data = jsPsych.data.get().last(1).values()[0];
      console.log(data.response)
      if(jsPsych.pluginAPI.compareKeys(data.response.confirmInitials,'Confirm')){
          return false;
      } else {
          return true;
      }
    }
}



  var rdktrial = {
    type: "rdk", 
    number_of_apertures: 3, //This needs to be set if more than one aperture
    trial_duration: 10000,
    correct_choice: "a",
    RDK_type: 3, //Applied to all apertures if only one value
    aperture_width: 200, //Applied to all apertures if only one value
    number_of_dots: [50, 200, 100], //Different parameter for each aperture. Array length must equal number_of_apertures
    aperture_center_x: [(window.innerWidth/2)-300,window.innerWidth/2,(window.innerWidth/2)+300] //Separate the apertures on the screen (window.innerWidth/2 is the middle of the screen)
};
















jsPsych.run([get_initials,confirm_initials,confirm_node]);
// jsPsych.run([enter_fullscreen]);

/*


	  var preload_trial = {
    type: 'preload',
    auto_preload: true

}

timeline.push(preload_trial)







// Instructions #1
       var instructions = {
           type: 'instructions',
           pages: function() {return [
               '<h1>Welcome!</h1>'

           ]},
           show_clickable_nav: true,
           button_label_previous: '',
           button_label_next: ''
       }

timeline.push(instructions)




// prompt for
var trial = {
  type: 'jspsych-survey-text',
  preamble: '<p>What are your intials?</p>',
  html: '<p><input type="text" id="test-resp-box" name="response" size="10" /></p>',
  autofocus: 'test-resp-box'
};

timeline.push(trial)

*/
//Instructions 2



/*
	var feedback = {
         type: 'html-keyboard-response',
         stimulus: function(){
           var last_trial_correct = jsPsych.data.get().last(1).values()[0].correct;
           if(last_trial_correct){
             return "<div style=\"width:150px;height:56px;font-size:30px;text-align:center;\">Correct!</div>";
           } else {
             return "<div style=\"width:150px;height:56px;border:0px;font-size:30px;text-align:center\">Wrong.</div>"
           }
         },
         trial_duration: function(){
           var last_trial_correct = jsPsych.data.get().last(1).values()[0].correct;
           if(last_trial_correct){
             return 1000;
           } else {
             return 1500
           }
         },
         response_ends_trial: false
       }



   var practice_block = {
        timeline: [buffer, discrimination_block, response_block, feedback],
        timeline_variables: practice_sequence,
        repetitions: 1,
        randomize_order: false
      }


timeline.push(practice_block);

timeline.push(debrief_block);

*/


// select all trials
// var all_data = jsPsych.data.get();

// get csv representation of data and log to console
// console.log(all_data.csv());


/* start the experiment */
//jatos.onLoad(function() {

/*
      on_finish: function() {
        //jsPsych.data.displayData('csv');
        var resultJson = jsPsych.data.get().csv();
      jatos.submitResultData(resultJson, jatos.endStudy);
      }
      */
    

  </script>
</html>
